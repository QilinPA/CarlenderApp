<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ตัวช่วยนับวันสำหรับ App Premium</title>
  <style>
    :root{
      --border:#e5e7eb; --muted:#6b7280; --fg:#111827; --bg:#ffffff;
      --card:#ffffff; --result:#f9fafb; --accent:#6d28d9;
    }
    body.theme-pastel{ --card:#f8f5ff; --result:#f4f4fb; --accent:#6d28d9; }
    body.theme-orange{ --card:#ffe9d5; --result:#fff5ed; --accent:#ea580c; }
    body.theme-red{ --card:#ffdede; --result:#fff1f2; --accent:#dc2626; }

    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--fg); background:var(--bg);
      max-width:860px; margin:32px auto; padding:0 16px; line-height:1.6;
    }
    h1{font-size:1.6rem;margin:0 0 .25rem}
    .muted{color:var(--muted);font-size:.95rem}

    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-top:16px}
    label{display:block;margin:.25rem 0 .35rem}
    input,select,button{
      font-size:1rem;padding:12px 14px;border:1px solid var(--border);border-radius:12px;width:100%;
      background:#fff;
    }
    input[disabled]{background:#f3f4f6;color:#6b7280;cursor:not-allowed}
    button{cursor:pointer}
    .btn{background:var(--accent);border:none;color:#fff}
    .btn:active{opacity:.9}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:640px){ .row{grid-template-columns:1fr} }

    .result{background:var(--result);border:1px dashed var(--border);border-radius:12px;padding:14px;margin-top:14px}
    .inline{display:flex;gap:8px;align-items:center}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
  </style>
</head>
<body class="theme-pastel">
  <h1>ตัวช่วยนับวัน สำหรับ App Premium</h1>
  <p class="muted">เลือกประเภทแอป → เลือกวันที่จากปฏิทิน → กรอกจำนวนวัน แล้วกดคำนวณ</p>

  <div class="card">
    <div class="row">
      <div>
        <label>ประเภทแอป</label>
        <select id="appType" aria-label="ประเภทแอป">
          <option value="youtube">YouTube – วันใหม่ 00:00</option>
          <option value="netflix" selected>Netflix – วันใหม่ 22:15</option>
        </select>
      </div>
      <div>
        <label>ธีมสี</label>
        <select id="theme" aria-label="ธีมสี">
          <option value="pastel" selected>พาสเทล</option>
          <option value="orange">ส้ม</option>
          <option value="red">แดง</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <div>
        <label>วันที่ซื้อ</label>
        <input id="purchaseDate" type="date" aria-label="วันที่ซื้อ" />
      </div>
      <div>
        <label>เวลาที่ซื้อ อ้างอิงเวลาที่เข้ามาใช้งาน</label>
        <input id="purchaseTime" type="time" step="60" disabled />
      </div>
    </div>

    <div class="row" style="margin-top:8px">
      <div>
        <label>จำนวนวัน</label>
        <input id="planDays" type="number" min="1" value="30" inputmode="numeric" placeholder="เช่น 30" />
      </div>
      <div>
        <label>เวลาเริ่มวันใหม่ของ Netflix</label>
        <div class="inline">
          <input id="cutoffTime" type="time" step="60" value="22:15" disabled />
          <span class="muted">YouTube จะถือวันใหม่ 00:00</span>
        </div>
      </div>
    </div>

    <div class="actions" style="margin-top:12px">
      <button id="calcBtn" class="btn">คำนวณ</button>
      <button id="copyBtn" type="button">คัดลอกสรุป</button>
    </div>

    <div id="out" class="result" hidden></div>
  </div>

  <p class="muted">ระบบใช้โซนเวลา <b>Asia/Bangkok</b>; ประเทศไทยไม่มี DST จึงบวกวันได้ตรง</p>

<script>
/* ---------- Utilities ---------- */
function todayYMD(){
  const n = new Date();
  return [n.getFullYear(), String(n.getMonth()+1).padStart(2,'0'), String(n.getDate()).padStart(2,'0')].join('-');
}
function nowHHMM(){
  const n = new Date();
  return String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0');
}
function parseISODate(s){ // yyyy-mm-dd from <input type=date>
  const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(s||"");
  if(!m) return null;
  return { y:+m[1], mo:+m[2], d:+m[3] };
}
function addDaysLocal(date, days){
  return new Date(date.getFullYear(), date.getMonth(), date.getDate()+days, 0, 0, 0, 0);
}
function setTimeLocal(date, hh, mm, ss=0, ms=0){
  return new Date(date.getFullYear(), date.getMonth(), date.getDate(), hh, mm, ss, ms);
}
function formatThaiDate(d){
  const dateStr = d.toLocaleDateString('th-TH', { timeZone: 'Asia/Bangkok' });
  const weekday = d.toLocaleDateString('th-TH', { weekday: 'short', timeZone: 'Asia/Bangkok' });
  return `${dateStr} (${weekday})`;
}

/* ---------- Init & UI ---------- */
const els = {
  appType: document.getElementById('appType'),
  theme: document.getElementById('theme'),
  purchaseDate: document.getElementById('purchaseDate'),
  purchaseTime: document.getElementById('purchaseTime'),
  planDays: document.getElementById('planDays'),
  cutoffTime: document.getElementById('cutoffTime'),
  calcBtn: document.getElementById('calcBtn'),
  copyBtn: document.getElementById('copyBtn'),
  out: document.getElementById('out')
};

// defaults
els.purchaseDate.value = todayYMD();
els.purchaseTime.value = nowHHMM();

// theme switch
els.theme.addEventListener('change', () => {
  document.body.className = 'theme-' + els.theme.value;
});

// show Netflix cutoff butไม่ให้แก้
function refreshByApp(){
  if(els.appType.value === 'netflix'){
    els.cutoffTime.value = '22:15';
  }else{
    els.cutoffTime.value = '00:00';
  }
}
els.appType.addEventListener('change', refreshByApp);
refreshByApp();

/* ---------- Core calculation ---------- */
function compute(){
  const datePicked = parseISODate(els.purchaseDate.value);
  const days = Math.max(1, parseInt(els.planDays.value || '1', 10));
  if(!datePicked){ show("กรุณาเลือกวันที่จากปฏิทิน"); return; }

  // Day 1 = วันที่เลือกเสมอ (00:00)
  const start = new Date(datePicked.y, datePicked.mo-1, datePicked.d, 0, 0, 0, 0);

  // วันหมดอายุ
  const expiryDate = addDaysLocal(start, days - 1);

  // เวลาสิ้นสุดสิทธิ์ในวันหมดอายุ
  let validUntil;
  if(els.appType.value === 'netflix'){
    // วันใหม่ของ Netflix คือ 22:15 → สิทธิ์สิ้นสุดที่ 22:14:59 ของวันหมดอายุ
    validUntil = setTimeLocal(expiryDate, 22, 14, 59, 999);
  }else{
    // YouTube สิ้นสุดสิทธิ์สิ้นวัน
    validUntil = setTimeLocal(expiryDate, 23, 59, 59, 999);
  }

  // แนะนำต่ออายุล่วงหน้า 1 วัน
  const renewSuggestDate = addDaysLocal(expiryDate, -1);

  const summary = [
    `แอป: ${els.appType.value === 'netflix' ? 'Netflix' : 'YouTube'}`,
    `Day 1 เริ่ม: ${formatThaiDate(start)}`,
    `หมดอายุ (Day ${days}): ${formatThaiDate(expiryDate)}`,
    `ใช้ได้ถึง: ${validUntil.toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })}`,
    `แนะนำต่ออายุล่วงหน้า 1 วัน: ${formatThaiDate(renewSuggestDate)}`
  ];

  show(summary.map(s=>`<div>${s}</div>`).join(""));
  els.copyBtn.onclick = () => {
    navigator.clipboard.writeText(summary.join('\n')).then(()=> {
      els.copyBtn.textContent = 'คัดลอกแล้ว ✓';
      setTimeout(()=>els.copyBtn.textContent='คัดลอกสรุป',1200);
    });
  };
}

function show(html){
  els.out.hidden = false;
  els.out.innerHTML = html;
}

els.calcBtn.addEventListener('click', compute);
</script>
</body>
</html>
